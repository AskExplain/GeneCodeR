<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GeneCodeR">
<title>Analysis of Spatial Transcriptomic data • GeneCodeR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis of Spatial Transcriptomic data">
<meta property="og:description" content="GeneCodeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GeneCodeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2022.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analysis_of_spatial_transcriptomics.html">Analysis of Spatial Transcriptomic data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analysis of Spatial Transcriptomic data</h1>
                        <h4 data-toc-skip class="author"><a href="mailto:help@askexplain.com" class="email">help@askexplain.com</a></h4>
            
            <h4 data-toc-skip class="date">2022-03-14</h4>
      
      
      <div class="d-none name"><code>analysis_of_spatial_transcriptomics.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="genecoder-analysis-of-spatial-transcriptomic-data">GeneCodeR analysis of Spatial Transcriptomic data<a class="anchor" aria-label="anchor" href="#genecoder-analysis-of-spatial-transcriptomic-data"></a>
</h3>
<p>Imaging tissue contains genes spatially organised by the
extracellular matrix, individual cell types and groups of cell
compartments. Using linear algebra and vectors, the expected patterns of
the histology images are learned (example patterns of (1): extracellular
matrix stained in eosin, and (2): nuclei of cells stained in
hematoxylin). Assigning each sample image to a learned pattern (by the
Generative Encoder algorithm) is similar to assigning an image weight to
a pattern vector. Accordingly, genes are also assigned weights to the
same set of expected image patterns. This encodes the information into
the same space.</p>
<p>The library that wraps around the Generative Encoder algorithm
(gcode) is called GeneCodeR and provides a more comprehensive interface
to load data from path, run gcode, extract relevant transformations, and
validate the learned patterns.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Main libraries for analysis</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">GeneCodeR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gcode</span><span class="op">)</span>

<span class="co"># Main libraries for plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></code></pre></div>
<p>Please replace these paths</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Please replace these paths</span>
<span class="va">path_to_save</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/main_files/AskExplain/GeneCoder/temp_save_dir/"</span>
<span class="va">path_to_work</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/main_files/AskExplain/GeneCoder/temp_work_dir/"</span></code></pre></div>
<p>Download data and format</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path_to_save</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path_to_work</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">path_to_work</span><span class="op">)</span>
<span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html" class="external-link">curl_download</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://data.mendeley.com/api/datasets-v2/datasets/29ntw7sh4r/zip/download?version=5"</span>, destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path_to_work</span>,<span class="st">"he_et_al.zip"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
<span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path_to_work</span>,<span class="st">"he_et_al.zip"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>, exdir <span class="op">=</span> <span class="va">path_to_work</span><span class="op">)</span>
<span class="va">path_to_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path_to_work</span>,<span class="st">"29ntw7sh4r-5"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">path_to_work</span><span class="op">)</span>

<span class="va">main_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_to_work</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">new_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"BC"</span>, replacement <span class="op">=</span> <span class="st">"BT"</span>, x <span class="op">=</span> <span class="va">main_files</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.rename</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">main_files</span>, to <span class="op">=</span> <span class="va">new_files</span><span class="op">)</span></code></pre></div>
<p>GeneCodeR takes in three input files from a generic Spatial
Transcriptomic dataset, per tissue slide:</p>
<p>1 - coordinates 2 - gene expression 3 - images</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Input list of files</span>

<span class="va">file_path_list</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_path_framework.html">extract_path_framework</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span>

<span class="va">file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_to_work</span>,pattern <span class="op">=</span> <span class="st">".csv.gz"</span>,full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">file_path_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_to_work</span>,pattern <span class="op">=</span> <span class="st">"stdata.tsv.gz"</span>,full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">file_path_list</span><span class="op">$</span><span class="va">pixel</span><span class="op">$</span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_to_work</span>,pattern <span class="op">=</span> <span class="st">".jpg"</span>,full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">train_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">*</span><span class="fl">0.6</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">test_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">train_ids</span><span class="op">]</span>

<span class="va">train_file_path_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_path_list</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>path<span class="op">=</span><span class="va">X</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="va">train_ids</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">test_file_path_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_path_list</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>path<span class="op">=</span><span class="va">X</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="op">-</span><span class="va">train_ids</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The GeneCodeR configuration file takes in several parameters.</p>
<p>The first set of parameters is information to extract spots - such as
spot size, and any augmentations such as displacement of the
coordinates, or rotation of the image.</p>
<p>The second set of parameters is for after the gcode model is learned
(via GeneCodeR wrapper). This is to transfrom from one modality, to
another modality (for example, from image to gene expression).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up genecoder configuration parameters</span>

<span class="va">genecoder.config</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_config_framework.html">extract_config_framework</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>The meta information file takes in several parameters per coordinate,
gene expression and image.</p>
<p>The first set of parameters is to read in the file. Here, example
parameters such as the file type (for example, is it a .csv, .tsv, .jpg,
.png, market matrix file (.mtx)?), and other important parameters based
on file type (for example, does it contain a header, what is the
separator …).</p>
<p>Importantly, another set of parameters is the factor identifier in
the coordinate file - which columns contain the x-coordinates,
y-coordinates and the label identifier for the spots? For example, the
label identifiers, are given by the rownames indicated by a 0.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up meta information</span>

<span class="va">meta_info_list</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_meta_framework.html">extract_meta_framework</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">file_type</span> <span class="op">&lt;-</span> <span class="st">"csv"</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">file_type</span> <span class="op">&lt;-</span> <span class="st">"tsv"</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">pixel</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">file_type</span> <span class="op">&lt;-</span> <span class="st">"image"</span>

<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">header</span> <span class="op">&lt;-</span> <span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">header</span> <span class="op">&lt;-</span> <span class="cn">T</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="st">","</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="st">"\t"</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">quote</span> <span class="op">&lt;-</span> <span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">quote</span> <span class="op">&lt;-</span> <span class="st">""</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">row.names</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">read_file</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">row.names</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">factor_id</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">factor_id</span><span class="op">$</span><span class="va">coord_x</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">factor_id</span><span class="op">$</span><span class="va">coord_y</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
<p>To run the analysis appropriately, a set of common genes are required
for all spots.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">common_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file_path_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu">read_file</span><span class="op">(</span>path <span class="op">=</span> <span class="va">file_path_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="va">X</span><span class="op">]</span>, meta_info <span class="op">=</span> <span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">read_file</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">factor</span><span class="op">$</span><span class="va">common_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"intersect"</span>,<span class="va">common_genes</span><span class="op">)</span></code></pre></div>
<p>Coordinate labels also need to be extracted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">factor</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">train_file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu">read_file</span><span class="op">(</span>path <span class="op">=</span> <span class="va">train_file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="va">X</span><span class="op">]</span>, meta_info <span class="op">=</span> <span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Gene expression data is extracted using the path list, meta
information, and configuration parameters.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract gex data</span>
<span class="va">gex_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_gex.html">prepare_gex</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">train_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span></code></pre></div>
<p>Importantly, labels for the meta information from the gene expression
data extraction is required for extracting relevant spots that contain
gene expression greater than background.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Store meta data</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">factor</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="va">gex_data</span><span class="op">$</span><span class="va">labels</span>

<span class="co"># Extract spot data</span>
<span class="va">spot_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_spot.html">prepare_spot</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">train_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span></code></pre></div>
<p>Relevant frameworks are set up to begin learning the Generative
Encoder model.</p>
<p>Firstly, set up the data list, which stores the gene expression and
spot data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up data</span>

<span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gex<span class="op">=</span><span class="va">gex_data</span><span class="op">$</span><span class="va">gex</span>,spot<span class="op">=</span><span class="va">spot_data</span><span class="op">$</span><span class="va">spot</span><span class="op">)</span></code></pre></div>
<p>The join framework is set up, creating the model structure that
learns (1): a similar function for “all” datasets, or (2): separate
functions across gene expression and image pixel spots.</p>
<p>Here, only the incode and the beta parameters are set up to learn the
individual patterns between genes and images. Given the samples are
extracted from the same tissue site (image and genes at the same spot),
the sample patterns are shared. The feature patterns and the sample
patterns (see first paragraph - genes assigned to expected image
patterns of hematoxylin and eosin stains) are mapped to a shared latent
space via the alpha and beta codes. For example, the use of image
patterns is analogous to pattern matching to the example image spot, the
latent codes un-rotate any example image spots until it best fits the
image pattern.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up join information</span>

<span class="va">join</span> <span class="op">&lt;-</span> <span class="fu">gcode</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gcode/man/extract_join_framework.html" class="external-link">extract_join_framework</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gex"</span>,<span class="st">"spot"</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>,<span class="st">"all"</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>,<span class="st">"all"</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">alpha.code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>,<span class="st">"all"</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">beta.code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>,<span class="st">"all"</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">incode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gex"</span>,<span class="st">"spot"</span><span class="op">)</span>
<span class="va">join</span><span class="op">$</span><span class="va">complete</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gex"</span>,<span class="st">"spot"</span><span class="op">)</span></code></pre></div>
<p>Set up configuration information - the dimensions of the encoding
space for the samples (i_dim), and the features (j_dim), as well as the
dimensions of the latent code (k_dim) are set up. The initialisation for
these parameters are set up via the irlba library using partial Singular
Value Decomposition.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up gcode config</span>

<span class="va">gcode.config</span> <span class="op">&lt;-</span> <span class="fu">gcode</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gcode/man/extract_config.html" class="external-link">extract_config</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span>
<span class="va">gcode.config</span><span class="op">$</span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"irlba"</span>,<span class="st">"irlba"</span><span class="op">)</span>
<span class="va">gcode.config</span><span class="op">$</span><span class="va">k_dim</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">gcode.config</span><span class="op">$</span><span class="va">i_dim</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">gcode.config</span><span class="op">$</span><span class="va">j_dim</span> <span class="op">&lt;-</span> <span class="fl">100</span></code></pre></div>
<p>Run the Generative Encoder model</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up gcode model</span>

<span class="va">genecoder.model</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/learn_model.html">learn_model</a></span><span class="op">(</span>data_list <span class="op">=</span> <span class="va">data_list</span>, config <span class="op">=</span> <span class="va">gcode.config</span>, join <span class="op">=</span> <span class="va">join</span><span class="op">)</span></code></pre></div>
<p>Now begins the testing validation phase…</p>
<p>First extract the test set of the coordinate factor labels.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Evaluate on test set</span>

<span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">factor</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">test_file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu">read_file</span><span class="op">(</span>path <span class="op">=</span> <span class="va">test_file_path_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="va">X</span><span class="op">]</span>, meta_info <span class="op">=</span> <span class="va">meta_info_list</span><span class="op">$</span><span class="va">coord</span><span class="op">$</span><span class="va">read_file</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Next extract the test set of the gene expression data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract test gex data</span>
<span class="va">test_gex_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_gex.html">prepare_gex</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">test_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>
<span class="va">meta_info_list</span><span class="op">$</span><span class="va">gex</span><span class="op">$</span><span class="va">factor</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="va">test_gex_data</span><span class="op">$</span><span class="va">labels</span></code></pre></div>
<p>Save relevant information, including the model, the test meta
information, the test file list and the test gene expression data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">genecoder.model</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"genecoder.RData"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">test_gex_data</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"test_gex.RData"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">meta_info_list</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"meta_info_list.RData"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">test_file_path_list</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"test_file_path_list.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Remove all files to clean up space for validation</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##           used (Mb) gc trigger (Mb) limit (Mb) max used (Mb)</span>
<span class="co">## Ncells  884144 47.3    1508517 80.6         NA  1508517 80.6</span>
<span class="co">## Vcells 1558217 11.9    8388608 64.0      16384  3467134 26.5</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Restore paths</span>
<span class="va">path_to_save</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/main_files/AskExplain/GeneCoder/temp_save_dir/"</span>
<span class="va">path_to_work</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/main_files/AskExplain/GeneCoder/temp_work_dir/"</span></code></pre></div>
<p>Reload important files recently saved:</p>
<p>1 - model learned 2 - test gene expression data 3 - test meta
information 4 - test file path information</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"genecoder.RData"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"test_gex.RData"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"meta_info_list.RData"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"test_file_path_list.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Set up the test configuration for GeneCodeR</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up genecoder transform information</span>
<span class="va">genecoder.config</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_config_framework.html">extract_config_framework</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span>
<span class="va">genecoder.config</span><span class="op">$</span><span class="va">transform</span><span class="op">$</span><span class="va">from</span> <span class="op">&lt;-</span> <span class="st">"spot"</span>
<span class="va">genecoder.config</span><span class="op">$</span><span class="va">transform</span><span class="op">$</span><span class="va">to</span> <span class="op">&lt;-</span> <span class="st">"gex"</span></code></pre></div>
<p>Set up validation functions to evaluate statistically significant
differences via a t-test, and, cosine similarity.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Testing functions</span>

<span class="co"># t.test for difference between observations</span>

<span class="va">t.test_difference_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">true_obs</span>,<span class="va">a</span>,<span class="va">b</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span> <span class="op">-</span> <span class="va">true_obs</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">b</span> <span class="op">-</span> <span class="va">true_obs</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># cosine metric for similarity between observations</span>

<span class="va">cosine.simil_sample_and_genes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span><span class="op">)</span><span class="op">{</span>
  
<span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    
    sample_wise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
      
      <span class="fu">lsa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">X</span>,<span class="op">]</span>,<span class="va">b</span><span class="op">[</span><span class="va">X</span>,<span class="op">]</span><span class="op">)</span>
      
    <span class="op">}</span>,mc.cores <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,
    
    gene_wise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
      
      <span class="fu">lsa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span>,<span class="va">X</span><span class="op">]</span>,<span class="va">b</span><span class="op">[</span>,<span class="va">X</span><span class="op">]</span><span class="op">)</span>
      
    <span class="op">}</span>,mc.cores <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
    
  <span class="op">)</span>
<span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<div class="figure">
<img src="base_validation.png" alt=""><p class="caption">Base validation</p>
</div>
<p>Base validation is used to directly compare observed gene expression
with transformed image spots representing gene expression via pattern
matching and weight assignment. Cosine similarity is used to compare the
observed and the transformed.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Base testing</span>

<span class="co"># Extract test spot data</span>

<span class="va">base_test_spot_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_spot.html">prepare_spot</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">test_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>

<span class="va">base_spot2gex</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/genecoder.html">genecoder</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">genecoder.model</span>, x <span class="op">=</span> <span class="va">base_test_spot_data</span><span class="op">$</span><span class="va">spot</span>, config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>

<span class="va">base_spot2gex</span> <span class="op">&lt;-</span> <span class="fu">cosine.simil_sample_and_genes</span><span class="op">(</span>a <span class="op">=</span> <span class="va">test_gex_data</span><span class="op">$</span><span class="va">gex</span>, <span class="va">base_spot2gex</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">base_spot2gex</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"base_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"base_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span>

<span class="va">title_name</span> <span class="op">=</span> <span class="st">"base_cosine_similarity"</span>
<span class="va">tissue_name</span> <span class="op">=</span> <span class="st">"breast"</span>

<span class="va">sample_similarity</span> <span class="op">=</span> <span class="va">base_spot2gex</span><span class="op">$</span><span class="va">sample_wise</span>
<span class="va">feature_similarity</span> <span class="op">=</span> <span class="va">base_spot2gex</span><span class="op">$</span><span class="va">gene_wise</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="va">lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Measure<span class="op">=</span><span class="va">sample_similarity</span>,Metric<span class="op">=</span><span class="st">"Predicted vs Observed \n Sample-wise Pearson Correlation"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Metric</span>,y<span class="op">=</span><span class="va">Measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> 

<span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Measure<span class="op">=</span><span class="va">feature_similarity</span>,Metric<span class="op">=</span><span class="st">"Predicted vs Observed \n Gene-wise Pearson Correlation"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Metric</span>,y<span class="op">=</span><span class="va">Measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> 

<span class="va">gg_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">g1</span>,<span class="va">g2</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="va">final_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span>
  grobs <span class="op">=</span> <span class="va">gg_plots</span>,
  layout_matrix <span class="op">=</span> <span class="va">lm</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final_plots</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_of_spatial_transcriptomics_files/figure-html/plot_base-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">final_plots</span>,filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path_to_save</span>,<span class="st">"/jpeg_accuracy_gcode_"</span>,<span class="va">tissue_name</span>,<span class="st">"_SPATIAL/"</span>,<span class="va">title_name</span>,<span class="st">"_accuracy_"</span>,<span class="va">tissue_name</span>,<span class="st">"_spatial.png"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,width <span class="op">=</span> <span class="fl">5</span>,height<span class="op">=</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="rotation_validation.png" alt=""><p class="caption">Rotation validation</p>
</div>
<p>Rotation testing is used to evaluate how rotated images affect the
differences between the rotated image transformed to gene expression and
the observed gene expression. It is expected that regardless of
rotation, the gene expression should not be statistically significantly
different across rotated images transformed to gene expression.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Spatial rotation testing</span>

<span class="va">rotate_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">rotate_val</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span>,<span class="fl">180</span>,<span class="fl">270</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">rotation</span> <span class="op">&lt;-</span> <span class="va">rotate_val</span>

  <span class="va">rotate_test_spot_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_spot.html">prepare_spot</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">test_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>

  <span class="va">rotate_spot2gex</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">rotate_val</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/genecoder.html">genecoder</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">genecoder.model</span>, x <span class="op">=</span> <span class="va">rotate_test_spot_data</span><span class="op">$</span><span class="va">spot</span>, config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">rotate_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">t.test_difference_obs</span><span class="op">(</span>true_obs <span class="op">=</span> <span class="va">test_gex_data</span><span class="op">$</span><span class="va">gex</span>, a <span class="op">=</span> <span class="va">rotate_spot2gex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, b <span class="op">=</span> <span class="va">rotate_spot2gex</span><span class="op">[[</span><span class="va">X</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">rotate_spot2gex</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"rotate_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"rotate_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rotate p-value"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0vs90:    "</span>,<span class="st">"0vs180:    "</span>,<span class="st">"0vs270:    "</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">rotate_spot2gex</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op">$</span><span class="va">p.value</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "rotate p-value"      "0vs90:     0.76472"  "0vs180:     0.96699"</span>
<span class="co">## [4] "0vs270:     0.81952"</span></code></pre>
<div class="figure">
<img src="displace_validation.png" alt=""><p class="caption">Displacement validation</p>
</div>
<p>Displacement testing is used to evaluate how gene levels change when
the image spot is displaced from where gene expression is experimentally
measured. It is expected that as the displacement increases, the gene
expression difference should become more statistically significantly
different.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Spatial displacement testing</span>

<span class="va">displace_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">displace_val</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">rotation</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">displacement_x</span> <span class="op">&lt;-</span> <span class="va">displace_val</span>
  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">displacement_y</span> <span class="op">&lt;-</span> <span class="va">displace_val</span>

  <span class="va">displace_test_spot_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_spot.html">prepare_spot</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">test_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>

  <span class="va">displace_spot2gex</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">displace_val</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/genecoder.html">genecoder</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">genecoder.model</span>, x <span class="op">=</span> <span class="va">displace_test_spot_data</span><span class="op">$</span><span class="va">spot</span>, config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">displace_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">t.test_difference_obs</span><span class="op">(</span>true_obs <span class="op">=</span> <span class="va">test_gex_data</span><span class="op">$</span><span class="va">gex</span>, a <span class="op">=</span> <span class="va">displace_spot2gex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, b <span class="op">=</span> <span class="va">displace_spot2gex</span><span class="op">[[</span><span class="va">X</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">displace_spot2gex</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"displace_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"displace_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"displace p-value"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0vs2:    "</span>,<span class="st">"0vs4:    "</span>,<span class="st">"0vs8:    "</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">displace_spot2gex</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op">$</span><span class="va">p.value</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "displace p-value"  "0vs2:     0.63127" "0vs4:     0.30681"</span>
<span class="co">## [4] "0vs8:     0.04463"</span></code></pre>
<div class="figure">
<img src="./similarity_validation.png" alt=""><p class="caption">Similarity validation</p>
</div>
<p>Similarity testing is used to evaluate how similar displaced image
spots are to the experimentally observed spot (for example, when both
images overlap). It is expected that similar spots should not be
statistically significantly different in gene expression levels.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Spatial similarity testing</span>

<span class="va">similar_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span>
    <span class="va">similar_val.x</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>
    <span class="va">similar_val.y</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span>
    <span class="va">similar_val.x</span> <span class="op">=</span> <span class="fl">3</span>
    <span class="va">similar_val.y</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
    <span class="va">similar_val.x</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>
    <span class="va">similar_val.y</span> <span class="op">=</span> <span class="fl">3</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">4</span><span class="op">)</span><span class="op">{</span>
    <span class="va">similar_val.x</span> <span class="op">=</span> <span class="fl">3</span>
    <span class="va">similar_val.y</span> <span class="op">=</span> <span class="fl">3</span>
  <span class="op">}</span>

  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">displacement_x</span> <span class="op">&lt;-</span> <span class="va">similar_val.x</span>
  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">displacement_y</span> <span class="op">&lt;-</span> <span class="va">similar_val.y</span>

  <span class="va">similar_test_spot_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_spot.html">prepare_spot</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">test_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>

  <span class="va">similar_spot2gex</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/genecoder.html">genecoder</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">genecoder.model</span>, x <span class="op">=</span> <span class="va">similar_test_spot_data</span><span class="op">$</span><span class="va">spot</span>, config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">similar_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">t.test_difference_obs</span><span class="op">(</span>true_obs <span class="op">=</span> <span class="va">test_gex_data</span><span class="op">$</span><span class="va">gex</span>, a <span class="op">=</span> <span class="va">similar_spot2gex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, b <span class="op">=</span> <span class="va">similar_spot2gex</span><span class="op">[[</span><span class="va">X</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">similar_spot2gex</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"similar_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"similar_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"similar p-value"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0,0vs(-)3,(-)3:    "</span>,<span class="st">"0,0vs3,(-)3:    "</span>,<span class="st">"0,0vs(-)3,3:    "</span>,<span class="st">"0,0vs3,3:    "</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">similar_spot2gex</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op">$</span><span class="va">p.value</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "similar p-value"             "0,0vs(-)3,(-)3:     0.61131"</span>
<span class="co">## [3] "0,0vs3,(-)3:     0.5161"     "0,0vs(-)3,3:     0.21426"   </span>
<span class="co">## [5] "0,0vs3,3:     0.61131"</span></code></pre>
<div class="figure">
<img src="signal_validation.png" alt=""><p class="caption">Signal validation</p>
</div>
<p>Signal testing is used to evaluate how gene expression signals change
over a spatial region when the example image spot slides over a spatial
region. It is expected that the gene expression should represent a
signal, such that a smoothing model can be learned with a reasonable and
flexible fit.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Spatial signal testing</span>

<span class="va">signal_spot2gex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">displacement_x</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">genecoder.config</span><span class="op">$</span><span class="va">extract_spots</span><span class="op">$</span><span class="va">displacement_y</span> <span class="op">&lt;-</span> <span class="fl">0</span>

  <span class="va">signal_test_spot_data</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/prepare_spot.html">prepare_spot</a></span><span class="op">(</span>file_path_list <span class="op">=</span> <span class="va">test_file_path_list</span>,meta_info_list <span class="op">=</span> <span class="va">meta_info_list</span>,config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>

  <span class="va">signal_spot2gex</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">GeneCodeR</span><span class="fu">::</span><span class="fu"><a href="../reference/genecoder.html">genecoder</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">genecoder.model</span>, x <span class="op">=</span> <span class="va">signal_test_spot_data</span><span class="op">$</span><span class="va">spot</span>, config <span class="op">=</span> <span class="va">genecoder.config</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">signal_spot2gex</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"signal_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span>


<span class="va">number_of_top_variable_genes_to_extract_adj.r.squared</span> <span class="op">&lt;-</span> <span class="fl">3</span>

<span class="va">spline_signal_adj.r.squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'rbind'</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">test_gex_data</span><span class="op">$</span><span class="va">gex</span>,<span class="fl">2</span>,<span class="va">var</span><span class="op">)</span>,decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">number_of_top_variable_genes_to_extract_adj.r.squared</span><span class="op">]</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">{</span>
  <span class="va">internal.adj.r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu">pbmcapply</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pbmcapply/man/pbmclapply.html" class="external-link">pbmclapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">signal_spot2gex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">{</span>
    <span class="va">signal_spline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>gene_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
      <span class="va">signal_spot2gex</span><span class="op">[[</span><span class="va">X</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">Z</span>,<span class="va">Y</span><span class="op">]</span>
    <span class="op">}</span><span class="op">)</span><span class="op">)</span>,displacement<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
    <span class="va">adj.r.squared</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">npreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/npreg/man/summary.html" class="external-link">summary.ss</a></span><span class="op">(</span><span class="fu">npreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/npreg/man/ss.html" class="external-link">ss</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">signal_spline</span><span class="op">$</span><span class="va">gene_level</span>,y <span class="op">=</span> <span class="va">signal_spline</span><span class="op">$</span><span class="va">displacement</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">adj.r.squared</span>,silent <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">signal_spline</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">adj.r.squared</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>,mc.cores <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">spline_signal_adj.r.squared</span>,file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"spline_signal_adj.r.squared.RData"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"signal_spot2gex.RData"</span><span class="op">)</span><span class="op">)</span>

  
<span class="va">signal_spline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>gene_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">'c'</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="va">signal_spot2gex</span><span class="op">[[</span><span class="va">X</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span><span class="op">)</span>,displacement<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod.ss</span> <span class="op">&lt;-</span> <span class="fu">npreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/npreg/man/summary.html" class="external-link">summary.ss</a></span><span class="op">(</span><span class="fu">npreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/npreg/man/ss.html" class="external-link">ss</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">signal_spline</span><span class="op">$</span><span class="va">gene_level</span>,y <span class="op">=</span> <span class="va">signal_spline</span><span class="op">$</span><span class="va">displacement</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">signal_spline</span><span class="op">$</span><span class="va">gene_level</span> <span class="op">~</span> <span class="va">signal_spline</span><span class="op">$</span><span class="va">displacement</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Adj.R-squared:    "</span>,<span class="va">mod.ss</span><span class="op">$</span><span class="va">adj.r.squared</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">signal_spline</span><span class="op">$</span><span class="va">gene_level</span>, <span class="va">mod.ss</span><span class="op">$</span><span class="va">y</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_of_spatial_transcriptomics_files/figure-html/plot_signal_1-1.png" width="700"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">""</span>,<span class="va">path_to_save</span>,<span class="st">"spline_signal_adj.r.squared.RData"</span><span class="op">)</span><span class="op">)</span>

<span class="va">title_name</span> <span class="op">=</span> <span class="st">"spatial_signal"</span>
<span class="va">tissue_name</span> <span class="op">=</span> <span class="st">"breast"</span>

<span class="va">first_most_variable_gene</span> <span class="op">=</span> <span class="va">spline_signal_adj.r.squared</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>
<span class="va">second_most_variable_gene</span> <span class="op">=</span> <span class="va">spline_signal_adj.r.squared</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>
<span class="va">third_most_variable_gene</span> <span class="op">=</span> <span class="va">spline_signal_adj.r.squared</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="va">lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Measure<span class="op">=</span><span class="va">first_most_variable_gene</span>,Metric<span class="op">=</span><span class="st">"Adj.R.Squared of Spline fits \n 1st most variable gene \n across all spatial spots"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Metric</span>,y<span class="op">=</span><span class="va">Measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> 

<span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Measure<span class="op">=</span><span class="va">second_most_variable_gene</span>,Metric<span class="op">=</span><span class="st">"Adj.R.Squared of Spline fits \n 2nd most variable gene \n across all spatial spots"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Metric</span>,y<span class="op">=</span><span class="va">Measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> 

<span class="va">g3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Measure<span class="op">=</span><span class="va">third_most_variable_gene</span>,Metric<span class="op">=</span><span class="st">"Adj.R.Squared of Spline fits \n 3rd most variable gene \n across all spatial spots"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Metric</span>,y<span class="op">=</span><span class="va">Measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> 

<span class="va">gg_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">g1</span>,<span class="va">g2</span>,<span class="va">g3</span><span class="op">)</span>

<span class="va">final_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span>
  grobs <span class="op">=</span> <span class="va">gg_plots</span>,
  layout_matrix <span class="op">=</span> <span class="va">lm</span>
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: Removed 1569 rows containing non-finite values (stat_ydensity).</span></code></pre>
<pre><code><span class="co">## Warning: Removed 1549 rows containing non-finite values (stat_ydensity).</span></code></pre>
<pre><code><span class="co">## Warning: Removed 742 rows containing non-finite values (stat_ydensity).</span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final_plots</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_of_spatial_transcriptomics_files/figure-html/plot_signal_2-1.png" width="700"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">final_plots</span>,filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path_to_save</span>,<span class="st">"/jpeg_accuracy_gcode_"</span>,<span class="va">tissue_name</span>,<span class="st">"_SPATIAL/"</span>,<span class="va">title_name</span>,<span class="st">"_accuracy_"</span>,<span class="va">tissue_name</span>,<span class="st">"_spatial.png"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,width <span class="op">=</span> <span class="fl">7</span>,height<span class="op">=</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Together, given the results are consistent with the expected output
based on a reasonable, flexible and appropriate model that learns
relevant information - GeneCodeR based on wrapping Generative Encoders,
can be considered an acceptable model for image analysis.
Transformational perturbations between gene expression and images, as
well as, other modalities based on current and future technologies is an
exciting development for spatial biology.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
